###############################################################################
#
# IAR ANSI C/C++ Compiler V8.50.9.278/W32 for ARM         12/Jan/2021  12:25:12
# Copyright 1999-2020 IAR Systems AB.
#
#    Cpu mode                    
#    Endian                   =  little
#    Source file              =
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\src\main.c
#    Command line             =
#        -f C:\Users\dvone\AppData\Local\Temp\EW3472.tmp
#        (C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\src\main.c
#        -D USE_STM32L0XX_NUCLEO -D USE_HAL_DRIVER -D USE_SYSTICK_DELAY -D
#        STM32L053xx -lC
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\NUCLEO_L0\List
#        -o
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\NUCLEO_L0\Obj
#        --debug --endian=little --cpu=Cortex-M0+ -e --fpu=None --dlib_config
#        "C:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.4\arm\inc\c\DLib_Config_Normal.h" -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\Sigfox_Libs\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\ST_API\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\..\..\Drivers\BSP\SDK_Eval_STM32\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\..\..\Drivers\MCU\STM32_HAL\STM32L0xx_HAL_Driver\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\..\..\Drivers\MCU\CMSIS\STM32L0xx\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\..\..\Drivers\S2LP_Middleware\STM32\inc\\
#        -I
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\..\..\..\..\..\Drivers\Utils\STM32\inc\\
#        -Ohz --use_c++_inline -I "C:\Program Files (x86)\IAR Systems\Embedded
#        Workbench 8.4\arm\CMSIS\Core\Include\\" -I "C:\Program Files (x86)\IAR
#        Systems\Embedded Workbench 8.4\arm\CMSIS\DSP\Include\\")
#    Locale                   =  C
#    List file                =
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\NUCLEO_L0\List\main.lst
#    Object file              =
#        C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\STM32\EWARM\NUCLEO_L0\Obj\main.o
#    Runtime model:              
#      __SystemLibrary        =  DLib
#      __dlib_file_descriptor =  0
#      __dlib_version         =  6
#
###############################################################################

C:\Users\dvone\Desktop\Divigraph\SigfoxDemo\Projects\Projects_Cube\S2-LP_SigFox_DK\SigfoxDemo\src\main.c
      1          /**
      2          * @file main.c
      3          * This application demonstrates interfacing a DHT11 sensor to the S2LP chip, and sending the data via Sigfox to AWS.
      4          * @details
      5          * This application sets the MCU in low power. in order to debug it using a SWD debugger it is necessary to:
      6          * - call the following function in the initialization phase:
      7          * \code
      8          * ST_MCU_API_LowPower(0);
      9          * \endcode
     10          * - comment out the following lines.
     11          * \code
     12          * ST_MCU_API_GPIO_LowPower();
     13          * HAL_PWR_EnterSTOPMode(PWR_LOWPOWERREGULATOR_ON,PWR_STOPENTRY_WFI);
     14          * ST_MCU_API_SetSysClock();
     15          * ST_MCU_API_GPIO_Restore();
     16          * \endcode
     17          *
     18          * \section IAR_project IAR project
     19          To use the project with IAR Embedded Workbench for ARM, please follow the instructions below:
     20          -# Open the Embedded Workbench for ARM and select File->Open->Workspace menu.
     21          -# Open the IAR project
     22          -# Select desired configuration to build
     23          -# Select Project->Rebuild All. This will recompile and link the entire application
     24          -# Select Project->Download and Debug to download the related binary image.
     25          *
     26          */
     27          
     28          #include "st_main.h"
     29          
     30          #ifdef USE_FLASH
     31          #include <string.h>
     32          #endif
     33          
     34          /* a flag to understand if the button has been pressed */

   \                                 In section .bss, align 1
     35          static volatile uint8_t but_pressed=0;
   \                     but_pressed:
   \        0x0                      DS8 1
     36          

   \                                 In section .text, align 2, keep-with-next
     37          void Appli_Exti_CB(uint32_t GPIO_Pin)
     38          {
     39            /* set the button pressed flag */
     40            but_pressed=1;
   \                     Appli_Exti_CB: (+1)
   \        0x0   0x2001             MOVS     R0,#+1
   \        0x2   0x....             LDR      R1,??DataTable1
   \        0x4   0x7008             STRB     R0,[R1, #+0]
     41          }
   \        0x6   0x4770             BX       LR               ;; return
     42          
     43          /**
     44          * @brief  Blink the LED indefinitely stucking the application.
     45          * @param  None
     46          * @retval None
     47          */

   \                                 In section .text, align 2, keep-with-next
     48          void Fatal_Error(void)
     49          {
   \                     Fatal_Error: (+1)
   \        0x0   0xB580             PUSH     {R7,LR}
     50            SdkEvalLedInit(LED2);
   \        0x2   0x2000             MOVS     R0,#+0
   \        0x4   0x....'....        BL       SdkEvalLedInit
     51          
     52            while(1)
     53            {
     54              SdkDelayMs(100);
   \                     ??Fatal_Error_0: (+1)
   \        0x8   0x2064             MOVS     R0,#+100
   \        0xA   0x....'....        BL       SdkDelayMs
     55              SdkEvalLedToggle(LED2);
   \        0xE   0x2000             MOVS     R0,#+0
   \       0x10   0x....'....        BL       SdkEvalLedToggle
   \       0x14   0xE7F8             B        ??Fatal_Error_0
     56            }
     57          }
     58          
     59          /**
     60          * @brief  Let the application led blinks.
     61          * @param  times Number of toggles.
     62          * @retval None
     63          */

   \                                 In section .text, align 2, keep-with-next
     64          void LedBlink(SdkEvalLed led, uint8_t times)
     65          {
   \                     LedBlink: (+1)
   \        0x0   0xB570             PUSH     {R4-R6,LR}
   \        0x2   0x0005             MOVS     R5,R0
   \        0x4   0x000C             MOVS     R4,R1
     66            SdkEvalLedInit(led);
   \        0x6   0x....'....        BL       SdkEvalLedInit
     67          
     68            for(uint8_t i=0;i<times;i++)
   \        0xA   0x2600             MOVS     R6,#+0
   \        0xC   0xE006             B        ??LedBlink_0
     69            {
     70              SdkEvalLedToggle(led);
   \                     ??LedBlink_1: (+1)
   \        0xE   0x0028             MOVS     R0,R5
   \       0x10   0x....'....        BL       SdkEvalLedToggle
     71              SdkDelayMs(50);
   \       0x14   0x2032             MOVS     R0,#+50
   \       0x16   0x....'....        BL       SdkDelayMs
     72            }
   \       0x1A   0x1C76             ADDS     R6,R6,#+1
   \                     ??LedBlink_0: (+1)
   \       0x1C   0xB2F0             UXTB     R0,R6
   \       0x1E   0x42A0             CMP      R0,R4
   \       0x20   0xD3F5             BCC      ??LedBlink_1
   \       0x22   0x0028             MOVS     R0,R5
     73          
     74            SdkEvalLedOn(led);
   \       0x24   0x....'....        BL       SdkEvalLedOn
     75          }
   \       0x28   0xBD70             POP      {R4-R6,PC}       ;; return
     76          
     77          /**
     78          * @brief  System main function.
     79          * @param  None.
     80          * @retval The function never returns.
     81          */

   \                                 In section .text, align 2, keep-with-next
     82          int main(void)
     83          {
   \                     main: (+1)
   \        0x0   0xB578             PUSH     {R3-R6,LR}
   \        0x2   0xB08D             SUB      SP,SP,#+52
     84            /* Some local variables to handle the workflow */
     85            ST_SFX_ERR stSfxRetErr;
     86            uint8_t ret_err, use_public_key = 0;
   \        0x4   0x2600             MOVS     R6,#+0
   \        0x6   0x2500             MOVS     R5,#+0
     87          
     88            /* Some variables to store the application data to transmit */
     89            uint32_t cust_counter=0;
   \        0x8   0x2400             MOVS     R4,#+0
   \        0xA   0xA801             ADD      R0,SP,#+4
   \        0xC   0x2100             MOVS     R1,#+0
   \        0xE   0x2200             MOVS     R2,#+0
   \       0x10   0x2300             MOVS     R3,#+0
   \       0x12   0xC00E             STM      R0!,{R1-R3}
     90            uint8_t customer_data[12]={0};
     91            uint8_t customer_resp[8];
     92          
     93            /* System initialization function */
     94            ret_err = ST_Init();
     95          
     96            if(ret_err)
   \       0x14   0x....'....        BL       ST_Init
   \       0x18   0x0600             LSLS     R0,R0,#+24
   \       0x1A   0xD001             BEQ      ??main_0
     97              Fatal_Error();
   \       0x1C   0x....'....        BL       Fatal_Error
     98          
     99            SdkDelayMs(10); //Wait for CS to rise
   \                     ??main_0: (+1)
   \       0x20   0x200A             MOVS     R0,#+10
   \       0x22   0x....'....        BL       SdkDelayMs
    100          
    101            /* Reset S2LP */
    102            S2LPShutdownEnter();
   \       0x26   0x....'....        BL       S2LPShutdownEnter
    103            SdkDelayMs(10);
   \       0x2A   0x200A             MOVS     R0,#+10
   \       0x2C   0x....'....        BL       SdkDelayMs
    104            S2LPShutdownExit();
   \       0x30   0x....'....        BL       S2LPShutdownExit
    105          
    106            /* Set the Push Button 2 as an input. If the application is started with the
    107            PUSH BUTTON 2 pressed, the public KEY is used by the applicaiton.
    108            This is useful for testing purposes or to use the SNEK emulator to receive
    109            Sigfox messages. */
    110            if (ButtonInit())
   \       0x34   0x....'....        BL       ButtonInit
   \       0x38   0x2800             CMP      R0,#+0
   \       0x3A   0xD00B             BEQ      ??main_1
    111            {
    112              use_public_key=1;
   \       0x3C   0x2501             MOVS     R5,#+1
    113              LedBlink(LED3, 1);
   \       0x3E   0x2101             MOVS     R1,#+1
   \       0x40   0x2000             MOVS     R0,#+0
   \       0x42   0x....'....        BL       LedBlink
    114          
    115              while(IsButtonPressed());	/* Wait until button is pressed */
   \                     ??main_2: (+1)
   \       0x46   0x....'....        BL       IsButtonPressed
   \       0x4A   0x2800             CMP      R0,#+0
   \       0x4C   0xD1FB             BNE      ??main_2
    116          
    117              LedBlink(LED3, 1);
   \       0x4E   0x2101             MOVS     R1,#+1
   \       0x50   0x....'....        BL       LedBlink
    118            }
    119          
    120          /* Only for STM32 eval platforms */
    121          #if  !(defined(BLUENRG2_DEVICE) || defined(BLUENRG1_DEVICE))
    122            /* The low level driver uses the internal RTC as a timer while the STM32 is in low power.
    123            This function calibrates the RTC using an auxiliary general purpose timer in order to
    124            increase its precision. */
    125            ST_MCU_API_TimerCalibration(500);
   \                     ??main_1: (+1)
   \       0x54   0x20FA             MOVS     R0,#+250
   \       0x56   0x0040             LSLS     R0,R0,#+1        ;; #+500
   \       0x58   0x....'....        BL       ST_MCU_API_TimerCalibration
    126          #endif
    127          
    128            /* Initialize push button 2 on the board as an interrupt */
    129            ButtonSetIRQ();
   \       0x5C   0x....'....        BL       ButtonSetIRQ
    130          
    131            if(S2LPEvalGetHasEeprom())
   \       0x60   0x....'....        BL       S2LPEvalGetHasEeprom
   \       0x64   0x2800             CMP      R0,#+0
   \       0x66   0xD00E             BEQ      ??main_3
    132            {
    133              /* Shutdown S2-LP in order to read EEPROM */
    134              ST_MCU_API_Shutdown(1);
   \       0x68   0x2001             MOVS     R0,#+1
   \       0x6A   0x....'....        BL       ST_MCU_API_Shutdown
    135              SdkDelayMs(1);
   \       0x6E   0x2001             MOVS     R0,#+1
   \       0x70   0x....'....        BL       SdkDelayMs
    136          
    137              /* Set EEPROM CS */
    138          #if  !(defined(BLUENRG2_DEVICE) || defined(BLUENRG1_DEVICE))
    139              if(SdkEvalGetDaughterBoardType() == FKI_SERIES)
   \       0x74   0x....'....        BL       SdkEvalGetDaughterBoardType
   \       0x78   0x2800             CMP      R0,#+0
   \       0x7A   0xD102             BNE      ??main_4
    140          	EepromCsPinInitialization();
   \       0x7C   0x....'....        BL       EepromCsPinInitialization
   \       0x80   0xE001             B        ??main_3
    141              else
    142          	EepromCsXnucleoPinInitialization();
   \                     ??main_4: (+1)
   \       0x82   0x....'....        BL       EepromCsXnucleoPinInitialization
    143          #else
    144              /* On BlueNRG-1/2 kits the only platform that supports EEPROM kit is the FKI001V1 */
    145          #ifdef FKI001V1
    146              EepromCsPinInitialization();
    147          #endif
    148          #endif
    149            }
    150          
    151            /* Init the Sigfox Library and the device for Sigfox communication*/
    152            NVM_BoardDataType boardData;
    153            stSfxRetErr = ST_Sigfox_Init(&boardData, 1);
    154          
    155            if(stSfxRetErr != ST_SFX_ERR_NONE)
   \                     ??main_3: (+1)
   \       0x86   0x2101             MOVS     R1,#+1
   \       0x88   0xA806             ADD      R0,SP,#+24
   \       0x8A   0x....'....        BL       ST_Sigfox_Init
   \       0x8E   0x2800             CMP      R0,#+0
   \       0x90   0xD001             BEQ      ??main_5
    156              Fatal_Error();
   \       0x92   0x....'....        BL       Fatal_Error
    157          
    158            if(use_public_key)
   \                     ??main_5: (+1)
   \       0x96   0x2D00             CMP      R5,#+0
   \       0x98   0xD002             BEQ      ??main_6
    159              enc_utils_set_public_key(1);
   \       0x9A   0x2001             MOVS     R0,#+1
   \       0x9C   0x....'....        BL       enc_utils_set_public_key
    160          
    161            SdkEvalLedInit(LED1);
   \                     ??main_6: (+1)
   \       0xA0   0x2000             MOVS     R0,#+0
   \       0xA2   0x....'....        BL       SdkEvalLedInit
    162            SdkEvalLedOn(LED1);
   \       0xA6   0x2000             MOVS     R0,#+0
   \       0xA8   0x....'....        BL       SdkEvalLedOn
   \       0xAC   0x....             LDR      R5,??DataTable1
    163          
    164            /* application main loop */
    165            while(1)
    166            {
    167          #if  !(defined(BLUENRG2_DEVICE) || defined(BLUENRG1_DEVICE))
    168              /* Go in low power with the STM32 waiting for an external interrupt */
    169              ST_MCU_API_GPIO_LowPower();
   \                     ??main_7: (+1)
   \       0xAE   0x....'....        BL       ST_MCU_API_GPIO_LowPower
    170              HAL_PWR_EnterSTOPMode(PWR_LOWPOWERREGULATOR_ON,PWR_STOPENTRY_WFI);
   \       0xB2   0x2101             MOVS     R1,#+1
   \       0xB4   0x2001             MOVS     R0,#+1
   \       0xB6   0x....'....        BL       HAL_PWR_EnterSTOPMode
    171              ST_MCU_API_SetSysClock();
   \       0xBA   0x....'....        BL       ST_MCU_API_SetSysClock
    172              ST_MCU_API_GPIO_Restore();
   \       0xBE   0x....'....        BL       ST_MCU_API_GPIO_Restore
    173          #endif
    174          
    175              if(but_pressed)
   \       0xC2   0x7828             LDRB     R0,[R5, #+0]
   \       0xC4   0x2800             CMP      R0,#+0
   \       0xC6   0xD0F2             BEQ      ??main_7
    176              {
    177                LedBlink(LED3, 6);
   \       0xC8   0x2106             MOVS     R1,#+6
   \       0xCA   0x2000             MOVS     R0,#+0
   \       0xCC   0x....'....        BL       LedBlink
    178          
    179                /* If the interrupt is raised, prepare the buffer to send with a 4-bytes counter */
    180                cust_counter++;
   \       0xD0   0x1C64             ADDS     R4,R4,#+1
    181          
    182          	for(uint8_t i=0;i<4;i++)
   \       0xD2   0x2000             MOVS     R0,#+0
    183          	  customer_data[i]=(uint8_t)(cust_counter>>((3-i)*8));
   \                     ??main_8: (+1)
   \       0xD4   0x2103             MOVS     R1,#+3
   \       0xD6   0x1A09             SUBS     R1,R1,R0
   \       0xD8   0x00C9             LSLS     R1,R1,#+3
   \       0xDA   0x0022             MOVS     R2,R4
   \       0xDC   0x40CA             LSRS     R2,R2,R1
   \       0xDE   0xA901             ADD      R1,SP,#+4
   \       0xE0   0x540A             STRB     R2,[R1, R0]
   \       0xE2   0x1C40             ADDS     R0,R0,#+1
   \       0xE4   0x2804             CMP      R0,#+4
   \       0xE6   0xDBF5             BLT      ??main_8
    184          
    185                /* Call the send_frame function */
    186                SIGFOX_API_send_frame(customer_data,4,customer_resp,2,0);
   \       0xE8   0x9600             STR      R6,[SP, #+0]
   \       0xEA   0x2302             MOVS     R3,#+2
   \       0xEC   0xAA04             ADD      R2,SP,#+16
   \       0xEE   0x2104             MOVS     R1,#+4
   \       0xF0   0xA801             ADD      R0,SP,#+4
   \       0xF2   0x....'....        BL       SIGFOX_API_send_frame
    187          
    188                LedBlink(LED3, 6);
   \       0xF6   0x2106             MOVS     R1,#+6
   \       0xF8   0x2000             MOVS     R0,#+0
   \       0xFA   0x....'....        BL       LedBlink
    189                but_pressed=0;
   \       0xFE   0x702E             STRB     R6,[R5, #+0]
   \      0x100   0xE7D5             B        ??main_7
    190              }
    191            }
    192          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable1:
   \        0x0   0x....'....        DC32     but_pressed
    193          
    194          #ifdef  USE_FULL_ASSERT
    195          /**
    196          * @brief  Reports the name of the source file and the source line number
    197          *         where the assert_param error has occurred.
    198          * @param file: pointer to the source file name
    199          * @param line: assert_param error line source number
    200          * @retval : None
    201          */
    202          void assert_failed(uint8_t* file, uint32_t line)
    203          {
    204            /* User can add his own implementation to report the file name and line number */
    205            //printf("Wrong parameters value: file %s on line %d\r\n", file, line);
    206          
    207            /* Infinite loop */
    208            while (1)
    209            {
    210            }
    211          }
    212          #endif
    213          
    214          
    215          /******************* (C) COPYRIGHT 2018 STMicroelectronics *****END OF FILE*****/

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   Appli_Exti_CB
       8   Fatal_Error
         8   -> SdkDelayMs
         8   -> SdkEvalLedInit
         8   -> SdkEvalLedToggle
      16   LedBlink
        16   -> SdkDelayMs
        16   -> SdkEvalLedInit
        16   -> SdkEvalLedOn
        16   -> SdkEvalLedToggle
      72   main
        72   -> ButtonInit
        72   -> ButtonSetIRQ
        72   -> EepromCsPinInitialization
        72   -> EepromCsXnucleoPinInitialization
        72   -> Fatal_Error
        72   -> HAL_PWR_EnterSTOPMode
        72   -> IsButtonPressed
        72   -> LedBlink
        72   -> S2LPEvalGetHasEeprom
        72   -> S2LPShutdownEnter
        72   -> S2LPShutdownExit
        72   -> SIGFOX_API_send_frame
        72   -> ST_Init
        72   -> ST_MCU_API_GPIO_LowPower
        72   -> ST_MCU_API_GPIO_Restore
        72   -> ST_MCU_API_SetSysClock
        72   -> ST_MCU_API_Shutdown
        72   -> ST_MCU_API_TimerCalibration
        72   -> ST_Sigfox_Init
        72   -> SdkDelayMs
        72   -> SdkEvalGetDaughterBoardType
        72   -> SdkEvalLedInit
        72   -> SdkEvalLedOn
        72   -> enc_utils_set_public_key


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable1
       8  Appli_Exti_CB
      22  Fatal_Error
      42  LedBlink
       1  but_pressed
     258  main

 
   1 byte  in section .bss
 334 bytes in section .text
 
 334 bytes of CODE memory
   1 byte  of DATA memory

Errors: none
Warnings: none
